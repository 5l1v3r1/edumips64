<project name="edumips64" default="jar" basedir=".">
	<target name="init">
        <!-- Set build file properties -->
		<property name="sourceDir" value="." />
        <property name="helpClassesDir" value="./javahelp_classes" />
		<property name="version" value="0.5.3" />
		<property name="outputDir" value="edumips" />
		<property name="jarFile" value="edumips64-${version}.jar" />
		<property name="tarbz2File" value="edumips64-${version}.tar.bz2" />
		<property name="svnJarFile" value="edumips64-svn.jar" />

        <!-- Create directories for the compilation process. -->
		<mkdir dir="${outputDir}" />
		<mkdir dir="${outputDir}/edumips64/img" />
		<mkdir dir="${outputDir}/edumips64/data" />
		<mkdir dir="${outputDir}/edumips64/utils" />
		<mkdir dir="${outputDir}/edumips64/help" />
	</target>

    <!-- *** clean *** target that cleans the built files and the build directory-->
	<target name="clean">
		<delete file="${jarFile}" />
		<delete file="${svnJarFile}" />
        <delete dir="${outputDir}" /> 
	</target>

    <!-- *** javadoc *** build the javadoc -->
	<target name="javadoc" depends="init">
		<mkdir dir="${outputDir}/docs" />
        <javadoc 
            destdir="${outputDir}/docs" 
		    author="true"
		    version="true"
		    use="true"
		    sourcepath="."
		    classpath="${sourceDir}/.."
		    packagenames="edumips64.*"/>
	</target>

	<target name="svnjar" depends="init">
        <javac 
            target="5" 
            srcdir="${sourceDir}" 
            classpath="${helpClassesDir}" 
            destdir="${outputDir}" 
            nowarn="yes" 
            debug="on" 
            debuglevel="lines,vars,source"/>

		<copy todir="${outputDir}/edumips64/img">
			<fileset dir="img">
				<include name="**/*.png" />
			</fileset>
		</copy>
		<copy todir="${outputDir}/edumips64/data">
			<fileset dir="data">
				<include name="**/*.txt" />
			</fileset>
		</copy>
		<copy todir="${outputDir}/edumips64/utils">
			<fileset dir="utils">
				<include name="**/*.properties" />
			</fileset>
		</copy>
		<jar destfile="${svnJarFile}" basedir="edumips">
			<manifest>
				<attribute name="Main-Class" value="edumips64.Main"/>
                <attribute name="SplashScreen-Image" value="edumips64/img/splash.png"/>
			</manifest>
		</jar>
		<signjar jar="${svnJarFile}" keystore="key-edumips" storepass="123456" keypass="123456" alias="edumips64" />
        <delete dir="${outputDir}" /> 
	</target>


	<target name="jar" depends="init">
        <javac 
            target="5" 
            srcdir="${sourceDir}" 
            classpath="${helpClassesDir}" 
            destdir="${outputDir}" 
            nowarn="yes"/>

		<copy todir="${outputDir}/edumips64/img">
			<fileset dir="img">
				<include name="**/*.png" />
			</fileset>
		</copy>
		<copy todir="${outputDir}/edumips64/data">
			<fileset dir="data">
				<include name="**/*.txt" />
			</fileset>
		</copy>
		<copy todir="${outputDir}/edumips64/utils">
			<fileset dir="utils">
				<include name="**/*.properties" />
			</fileset>
		</copy>
		<jar destfile="${jarFile}" basedir="edumips">
			<manifest>
				<attribute name="Main-Class" value="edumips64.Main"/>
                <attribute name="SplashScreen-Image" value="edumips64/img/splash.png"/>
			</manifest>
		</jar>
		<signjar jar="${jarFile}" keystore="key-edumips" storepass="123456" keypass="123456" alias="edumips64" />
        <delete dir="${outputDir}" /> 
	</target>

    <target name="release" depends="init">
        <mkdir dir="edumips64" />
		<copy todir="edumips64/">
			<fileset dir=".">
				<include name="**/*" />
			</fileset>
		</copy>

        <tar destfile="${tarbz2File}" basedir="." includes="edumips64/" compression="bzip2" />
        <delete dir="edumips64" /> 
    </target> 
</project>
